<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="/admin.css" rel="stylesheet" type="text/css"/>
    <link href="/createnew.css" rel= "stylesheet" type="text/css"/>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <title>Create New Restaurant Page</title>
  </head>
  <body>
    <!--------- header with logo and user login status-------->
    
    <div class = "head-line">
      <a class="link-home" href="https:/manage">
        <img class="logo" src="https://cdn.glitch.com/54ccc57e-2201-4986-a083-7d154d5c4e6a%2Fdining_icon-01.png?v=1575671513396"/>
      </a>
      
      <% if (curUser) {%>
        <%if (curUserRole == "client"){%>
          <a class="loged-in" href="/login/profile">Hi,<%= curUserName%></a> 
        <%} else{%>
          <a class="loged-in" href="/manage">Hi,<%= curUserName%></a>
          <%}%>
          <a href="/logout">
            <img class="userLogo" src="https://cdn.glitch.com/54ccc57e-2201-4986-a083-7d154d5c4e6a%2Ffree-exit-logout-icon-2857-thumb.png?v=1575877712357"/>
          </a>
      <%} else {%>
        <a class="link-login" href="/login">
          <img class="userLogo" src="https://cdn.glitch.com/54ccc57e-2201-4986-a083-7d154d5c4e6a%2Freservation-icon-28.jpg?v=1575877205463"/>
        </a >
      <%}%>
    </div> 
    <!----------------------- forms---------------------->
    <div class="container">
      <form id="formRest"></form>
      <div class="row">
        <label for="name">Name:</label>
        <input type="text" value=<%=%> class="form-control" name="name" form="formRest"/>
      </div>
      <div class="row">
        <label for="city">City:</label>
        <input type="text" value=<%=%> class="form-control text-center" name="city" form="formRest"/>
      </div>
      <div class="row">
        <label for="zip">Zip code:</label>
        <input type="text" value=<%=%> class="form-control" name="zip" form="formRest"/>
      </div> 
      <div class="row">
        <label for="address">Street Address</label>
        <input type="text" value=<%=%> class="form-control" name="address" form="formRest"/>
      </div>
      <div class="row">
        <label for="contact">Phone:</label>
        <input type="text" value=<%=%> class="form-control" name="contact" form="formRest"/>
      </div> 
      <div class="row">
        <label for="cuisine">Cuisine Type:</label>
        <input type="text" value=<%=%> class="form-control" name="cuisine" form="formRest"/>
      </div> 
      <div class="row">
        <label for="price">Price Level:</label>
        <input type="text" value=<%=%> class="form-control text-center" name="price" form="formRest"/>
      </div> 
      <div class="row">
        <label for="opendays"> Open Days:</label>
        <input type="text" value=<%=%> class="form-control text-center" name="opendays" form="formRest"/>
      </div>
      <div class="row">
        <label for="img">Image URL</label>
        <input type="text" value=<%=%> class="form-control" name="img" form="formRest"/>
      </div>
      <div class="row">
        <label for="option" >Options</label>
        <input type="text" value=<%=%> class="form-control" name="options" form="formRest"/>
        <a class="create">Update</a>
        <a href="/manage">Cancel</a>
      </div>
      </div>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script>
          $(document).ready(function() {
          $('.add-btn').click(function() {
          var cl = $('.ifields').first().clone(true);
          $('.iclone').append(cl);});
          });
      
        $(".create").click(function(){
           var options = $('.row.ifields').map(function(){
              return {
                time: $(this).find('[name="time"]').val(),
                size: $(this).find('[name="size"]').val()
              };
            }).get();

            var data = $('.container').map(function() {
              return {
                name: $(this).find('[name="name"]').val(),
                city: $(this).find('[name="city"]').val(),
                zip: $(this).find('[name="zip"]').val(),
                address: $(this).find('[name="address"]').val(),
                contact: $(this).find('[name="contact"]').val(),
                cuisine: $(this).find('[name="cuisine"]').val(),
                price: $(this).find('[name="price"]').val(),
                opendays: $(this).find('[name="opendays"]').val(),
                img:$(this).find('[name="img"]').val(),
                options: options};
            });
          // console.log(options);
          console.log(data);

          $.ajax({
            url: 'https://final-pro-yay76-feq6.glitch.me/manage/newrest',
            type: 'POST',
            data: JSON.stringify({Rest: data}),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(data){alert(data);window.location.assign("https://final-pro-yay76-feq6.glitch.me/manage");},
            failure: function(errMsg) {
                alert(errMsg);
            }
          });
        });     
     
    </script>
  
  </body>  
</html>


